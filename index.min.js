export default class t{#a=[{}];#b;#c=null;#d;#e;#f;#g;#h;#i;#j;#k=null;#l=null;#m;#n=null;#o=null;#p;#q;#r;#s;#t=null;#u=null;#v;#w=!0;#x=0;#y="main";#z=0;#A=0;#B=0;#C=0;#D=0;#E=1;#F=1;#G;#H;#I;#J=!0;#K=!0;#L=!0;#M;#N;#O=null;#P;#Q;#R;#S;#T;#U;#V;#W;#X=[];constructor(t,e){this.#d=e,this.#d.style.overflow="hidden",Array.isArray(t)?"[object Object]"!==Object.prototype.toString.call(t[0])?this.#X.push("Invalid Data | Data is Not An Array Object | Data must be Array Object"):this.#a=t:this.#X.push("Invalid Data | Data is Not An Array | Data must be Array Object"),this.POSITIONS={LEFT:"justify-content: flex-start;",RIGHT:"justify-content: flex-end;",CENTER:"justify-content: center;",BETWEEN:"justify-content: space-between;",AROUND:"justify-content: space-around;",EVENLY:"justify-content: space-evenly;"}}config(t={},e="grid"){this.#b=this.#a,this.#G=t.perPage||20,this.#M=t.lazyloadImageColor||"#eee",this.#V=t.autoload||!1,this.#W=t.autoloadWhen||10,this.#R=t.autoFetch||!1,this.#S=t.autoFetchWhen||40,this.dataApiUrl=t.dataApiUrl||"",this.dataApiOptions=t.dataApiOptions||{},!this.#R||(""==this.dataApiUrl?this.#X.push("Data API Url not provided for fetching data."):"string"!=typeof this.dataApiUrl?this.#X.push("Invalid Data API Url"):this.dataApiUrl.startsWith("http")||this.dataApiUrl.startsWith("https")||this.#X.push("Invalid Data API Url .Protocol not Provided")),this.#h=t.gridGap||"10px",this.#j=t.gridItemMinWidth||"200px",this.#i=t.gridItemWidth||"fit",t.gridItemMinWidth&&t.gridItemMinWidth.endsWith("%")&&this.errors.push("In gridItemMinWidth % percentage is not allowed"),t.gridItemWidth&&t.gridItemWidth.endsWith("%")&&this.errors.push("In gridItemWidth % percentage is not allowed"),this.#q=t.listGap||"10px",this.#s=t.listItemMinWidth||"500px",this.#r=t.listItemWidth||"fit",t.listItemMinWidth&&t.listItemMinWidth.endsWith("%")&&this.errors.push("In listItemMinWidth % percentage is not allowed"),t.listItemWidth&&t.listItemWidth.endsWith("%")&&this.errors.push("In listItemWidth % percentage is not allowed"),this.searchIn=t.searchIn||"all",this.searchCaseSensitive=t.searchCaseSensitive||!1,this.#N=t.animation||!1,this.#P=t.animationDuration?.slice(0,-1)||".5",this.#Q=t.position||this.POSITIONS.LEFT,this.#f=e,this.#H=this.#Y(),this.columns=Object.keys(this.#a[0]),this.selected=[],this.inSelection=!1,this.#c=new Templator({lazyloadImageColor:this.#M}),this.#T=new IntersectionObserver(t=>{let e=t.length;for(let i=0;i<e;i++)if(t[i].isIntersecting){let s=t[i].target;s.src=s.dataset.viewLoadimg,s.style.visibility="visible",this.#T.unobserve(s)}},{rootMargin:"300px"}),this.#V&&(this.#U=new IntersectionObserver(t=>{let e=t.length;for(let i=0;i<e;i++)t[i].isIntersecting&&(this.#E<this.#H&&(this.#Z(!1),"main"==this.#y?this.#E++:this.#F++),this.#U.unobserve(t[i].target))},{rootMargin:"100px"}));let i=(t="none")=>{this.#g=document.createElement("div"),this.#g.id="ViewGridContainer",this.gridContainerClass="data-view-grid",this.#g.className=this.gridContainerClass,this.#g.style.display=t,this.#g.style.gap=this.#h,this.#g.style.position="relative",this.#d.append(this.#g),this.#$()},s=(t="none")=>{this.#p=document.createElement("div"),this.#p.id="ViewListContainer",this.listContainerClass="data-view-list",this.#p.className=this.listContainerClass,this.#p.style.display=t,this.#p.style.gap=this.#q,this.#p.style.position="relative",this.#d.append(this.#p),this.#_()},r=(t="none")=>{this.#m=document.createElement("table"),this.#m.id="ViewTableContainer",this.#m.style.position="relative",this.tableClass="data-view-table table",this.#m.className=this.tableClass,this.#m.createTBody(),this.#m.style.display=t,this.#d.append(this.#m)};"grid"==e?(i("grid"),this.#e=this.#g):"list"==e?(s("grid"),this.#e=this.#p):"table"==e&&(r("table"),this.#e=this.#m),this.#v=document.createElement("div"),setTimeout(()=>{if("grid"!=e&&i(),"list"!=e&&s(),"table"!=e&&r(),null==this.#m.tHead){let a=this.#m.createTHead(),n="<tr>";for(let h=0;h<this.#n.length;h++)n+=`<th>${this.#n[h]}</th>`;n+="</tr>",a.innerHTML=n}this.apiSearching=t.apiSearching||!1,this.searchApi=t.searchApi||"",this.searchApiOptions=t.searchApiOptions||"",!this.apiSearching||(""==this.searchApi?this.#X.push("Search API Url not provided for fetching data."):"string"!=typeof this.searchApi?this.#X.push("Invalid Search API Url"):this.searchApi.startsWith("http")||this.searchApi.startsWith("https")||this.#X.push("Invalid Search API Url .Protocol not Provided")),this.#v.id="ViewSearchContainer",this.#v.style.display="grid",this.#v.style.position="relative",this.#d.append(this.#v),window.addEventListener("resize",()=>{this.#$()})},2500)}get totalPages(){let t;return"main"==this.#y?t=this.#H:"search"==this.#y&&(t=this.#I),t}get currentPage(){let t;return"main"==this.#y?t=this.#E:"search"==this.#y&&(t=this.#F),t}get errors(){return this.#X}get register(){let t=this;return{templator(e){t.#c.register(e)}}}set listItemTemplate(t){if(this.#X.length>0)return;if(!(t=t.trim()).startsWith("<"))return this.#X.push("Invalid List Item Template"),"";let e=t.slice(1,t.search(/<* /));if(!t.endsWith(`</${e}>`))return this.#X.push("Invalid List Item Template"),"";this.#u=e,this.#t=this.#c.oneTimeParse(t)}set gridItemTemplate(t){if(this.#X.length>0)return;if(!(t=t.trim()).startsWith("<"))return this.#X.push("Invalid Grid Item Template"),"";let e=t.slice(1,t.search(/<* /));if(!t.endsWith(`</${e}>`))return this.#X.push("Invalid Grid Item Template"),"";this.#l=e,this.#k=this.#c.oneTimeParse(t)}set tableRowHtml(t){if(!(this.#X.length>0)){if(!(t=t.trim()).startsWith("<"))return this.#X.push("Invalid Table Row Template"),"";this.#o=this.#c.oneTimeParse(t)}}set tableColumns(t){if(this.#n=t,"table"==this.#f){let e=this.#m.createTHead(),i="<tr>";for(let s=0;s<this.#n.length;s++)i+=`<th>${this.#n[s]}</th>`;i+="</tr>",e.innerHTML=i}}set perPage(t){if(this.#G=parseInt(t),this.#H=this.#Y(),this.#z+this.#G>this.#a.length||this.#z<this.#G)this.#z=0,this.#E=1;else{this.#E=1;for(let e=0;e<this.#z;e+=this.#G)e+this.#G>this.#z?this.#z=e:this.#E++}this.#A=this.#z,this.#J=!0,this.#K=!0,this.#L=!0,this.#Z()}set view(t){if(this.inSelection)return"You are in Selection Mode";switch(this.#f=t,t){case"grid":this.#p.style.display="none",this.#m.style.display="none",this.#g.style.display="grid",this.#e=this.#g,this.#J&&(this.#A=this.#z,this.#Z());break;case"list":this.#g.style.display="none",this.#m.style.display="none",this.#p.style.display="grid",this.#e=this.#p,this.#K&&(this.#A=this.#z,this.#Z());break;case"table":this.#g.style.display="none",this.#p.style.display="none",this.#m.style.display="table",this.#e=this.#m,this.#L&&(this.#A=this.#z,this.#Z())}}async search(t){if(this.inSelection)return"You are in Selection Mode";if(""==t){"grid"==this.#f?(this.#e=this.#g,this.#g.style.display="grid"):"list"==this.#f?(this.#e=this.#p,this.#p.style.display="grid"):"table"==this.#f&&(this.#e=this.#m,this.#m.style.display="table"),this.#v.style.display="none",this.#b=this.#a,this.#F=1,this.#y="main";return}if(this.#w&&(this.#w=!1,this.#aa()),this.apiSearching){let e=this.searchApi.replace(/{(.*?)}/g,(e,i)=>"query"==i?t:"searchCaseSensitive"==i?this.searchCaseSensitive:"column"==i?this.searchIn:void 0),i=await fetch(e,this.searchApiOptions);i=await i.json(),this.#b=i}else this.#b=this.#a.filter(e=>"all"==this.searchIn?this.searchCaseSensitive?JSON.stringify(e).includes(t):JSON.stringify(e).toLowerCase().includes(t.toLowerCase()):this.searchCaseSensitive?String(e[this.searchIn]).includes(t):String(e[this.searchIn]).toLowerCase().includes(t.toLowerCase()));this.#e!=this.#v&&("grid"==this.#f?this.#g.style.display="none":"list"==this.#f?this.#p.style.display="none":"table"==this.#f&&(this.#m.style.display="none"),"table"==this.#f?(this.#e=this.#m,this.#e.style.display="table"):(this.#e=this.#v,this.#e.style.display="grid")),this.#B=0,this.#C=0,this.#F=1,this.#I=this.#Y(),this.#y="search",this.#Z()}render(){this.#Z()}async #ab(){if(this.#a.length-(this.#A+1)<=this.#S){let t=this.dataApiUrl.replace(/{(.*?)}/g,(t,e)=>{if("last"==e||"last:index"==e)return this.#a.length-1;if("last:counter"==e)return this.#a.length;if(e.startsWith("last:"))return this.#a[this.#a.length-1][e.slice(5)]?.toString().replace(/ /g,"%20");if("perPage"==e)return this.#G}),e=await fetch(t,this.dataApiOptions);try{e=await e.json(),this.#a=this.#a.concat(e),this.#b=this.#a,this.#H=this.#Y()}catch(i){console.error(i)}}}#Z(s=!0){if(this.errors.length>0)return;let r,a,n;if("main"==this.#y?(a=s?this.#z:++this.#A,n=this.#A):"search"==this.#y&&(a=s?this.#B:++this.#C,n=this.#C),"grid"==this.#f){if(null==this.#k)return this.#X.push("Please Set Grid Item Template"),null;this.#J=!1,r=this.#k}else if("list"==this.#f){if(null==this.#t)return this.#X.push("Please Set List Item Template"),null;this.#K=!1,r=this.#t}else if("table"==this.#f){if(null==this.#o)return this.#X.push("Please Set Table Row Template"),null;this.#L=!1,r=this.#o}let h=this.#G+n,l,o="";for(l=a;l<h&&void 0!=this.#b[l];l++)o+=this.#c.parseOnEveryRow(r,this.#b[l],l);if(this.#A=--l,"search"==this.#y&&(this.#C=this.#A),!1!=this.#N&&null!=this.#O)this.#ac(()=>{let t=this.#e;"table"==this.#f&&(t=t.tBodies[0]),s?t.innerHTML=o:t.innerHTML+=o,setTimeout(()=>{let t=document.querySelectorAll(`#${this.#e.id} img[data-view-loadimg]`),e=t.length;for(let i=0;i<e;i++)this.#T.observe(t[i]);this.#V&&("table"==this.#f?this.#U.observe(Array.from(this.#e.rows).at(-this.#W)):this.#U.observe(Array.from(this.#e.children).at(-this.#W)))},30)},this.#e);else{let d=this.#e;"table"==this.#f&&(console.log(this.#e),d=d.tBodies[0]),s?d.innerHTML=o:d.innerHTML+=o,setTimeout(()=>{let t=document.querySelectorAll(`#${this.#e.id} img[data-view-loadimg]`),e=t.length;for(let i=0;i<e;i++)this.#T.observe(t[i]);this.#V&&("table"==this.#f?this.#U.observe(Array.from(this.#e.rows).at(-this.#W)):this.#U.observe(Array.from(this.#e.children).at(-this.#W)))},30)}this.#R&&setTimeout(()=>{this.#ab()},200),this.inSelection&&setTimeout(()=>{this.#ad(a,this.#A)},100)}#ad(c,g){let m=this.selectionOptions;if(this.#e==this.#m){let p=this.#e.rows;if(0==c){var u=p[0].insertCell(0);u.innerHTML=`<input type="checkbox" class="${m.class}" selection="all">`}for(let C=c;C<=g&&void 0!=p[C+1];C++){var u=p[C+1].insertCell(0);u.innerHTML=`<input type="checkbox" class="${m.class}" selection="${C}">`}}else{let w=this.#e.children;if(void 0==w[c]){console.log(`start : ${c}`),console.log(`this.#perPage : ${this.#G}`),console.log(`this.#currentPage : ${this.#E}`);let f=this.#e.querySelectorAll("input[selection]"),v=f.length,$=f.length+this.#G;console.log(`startIndex : ${v}`),console.log(`last : ${$}`),console.log(w[$]);for(let R=v;R<=$&&void 0!=w[R];R++)w[R].insertAdjacentHTML("afterbegin",`<input type="checkbox" class="${m.class}" selection="${R}" style="position: absolute;top: ${m.top};right:${m.right};bottom:${m.bottom};left: ${m.left};z-index: 5;">`)}else for(let y=c;y<=g&&void 0!=w[y];y++)w[y].insertAdjacentHTML("afterbegin",`<input type="checkbox" class="${m.class}" selection="${y}" style="position: absolute;top: ${m.top};right:${m.right};bottom:${m.bottom};left: ${m.left};z-index: 5;">`)}}startSelection(t=!1,e={}){e.top=e?.top||"10px",e.right=e?.right||"auto",e.bottom=e?.bottom||"auto",e.left=e?.left||"10px",e.class=e?.class||"selection",this.selectionOptions=e,this.inSelection=!0,this.#e.rows?this.#ad(0,this.#e.rows.length-1):this.#ad(0,this.#e.children.length-1),this.#d.onclick=e=>{let i;if(i=this.#e==this.#g?e.target.closest(`#ViewGridContainer > ${this.#l}`):this.#e==this.#p?e.target.closest(`#ViewListContainer > ${this.#u}`):e.target.closest("tbody tr")){let s=i.querySelector("input[selection]");if(!s)return;e.target!=s&&(s.checked=!s.checked);let r=Number(s.getAttribute("selection"));s.checked?(this.selected.push({index:r,data:this.#b[r]}),s.setAttribute("checked",!0)):(s.removeAttribute("checked"),this.selected.splice(this.selected.findIndex(t=>t.index==r),1)),!1!=t&&t({index:r,element:i,checked:s.checked})}else{let a=this.#e.querySelector("input[selection=all]");if(a){let n=this.#e.querySelectorAll("input[selection]"),h=n.length-1;if(a.checked)for(let l=0;l<h;l++){let o=n[l+1];this.selected.push({index:l,data:this.#b[l]}),o.setAttribute("checked",!0),o.checked=!0}else for(let d=0;d<h;d++){let c=n[d+1];c.removeAttribute("checked"),c.checked=!1,this.selected.splice(this.selected.findIndex(t=>t.index==d),1)}!1!=t&&t({checked:a.checked})}}}}stopSelection(){this.selected=[],this.inSelection=!1;let t=this.#e.querySelectorAll("input[selection]"),e=t.length;if(this.#e.rows)for(let i=0;i<e;i++)t[i].parentElement.remove();else for(let s=0;s<e;s++)t[s].remove();this.#d.onclick=null}updateData(t){this.#a=t(this.#a)}jumpToPage(t){if(this.inSelection)return"You are in Selection Mode";if("main"==this.#y){this.#E=t,this.#z=0;for(let e=1;e<t;e++)this.#z+=this.#G;this.#A=this.#z}else if("search"==this.#y){this.#F=t,this.#B=0;for(let i=1;i<t;i++)this.#B+=this.#G;this.#C=this.#B}this.#J=!0,this.#K=!0,this.#L=!0,this.#Z()}nextPage(){if(this.inSelection)return"You are in Selection Mode";"main"==this.#y?this.#E<this.#H&&(this.#z=++this.#A,this.#J=!0,this.#K=!0,this.#L=!0,this.#E+=1,this.#O="nextPage",this.#Z()):"search"==this.#y&&this.#F<this.#I&&(this.#B=++this.#C,console.log(`this.#searchLastRenderRow : ${this.#C}`),console.log(`this.#searchLastRenderRowForNext : ${this.#D}`),this.#F+=1,this.#O="nextPage",this.#Z())}previousPage(){if(this.inSelection)return"You are in Selection Mode";"main"==this.#y?this.#E>1&&(this.#z-=this.#G,this.#A=this.#z,this.#J=!0,this.#K=!0,this.#L=!0,this.#E--,this.#O="previousPage",this.#Z()):"search"==this.#y&&this.#F>1&&(this.#B-=this.#G,this.#C=this.#B,console.log(`this.#searchLastRenderRow : ${this.#C}`),console.log(`this.#searchLastRenderRowForNext : ${this.#D}`),this.#F--,this.#O="previousPage",this.#Z())}#aa(b=null){this.#e.id==this.#g.id||"grid"==b?(this.#v.style.gap=this.#h,this.#$(this.#v)):this.#e.id==this.#p.id||"list"==b?(this.#v.style.gap=this.#q,this.#_(this.#v)):this.#v.style.gridTemplateColumns="repeat(1,1fr)"}#ac(I,P){switch(this.#N){case"slide":switch(this.#O){case"nextPage":P.classList.remove("slide-left-out"),P.classList.remove("slide-left-in"),P.classList.add("slide-left-out"),setTimeout(()=>{I(),P.classList.add("slide-left-in")},1e3*this.#P),setTimeout(()=>{P.classList.remove("slide-left-out"),P.classList.remove("slide-left-in")},1e3*this.#P+1e3*this.#P);break;case"previousPage":P.classList.remove("slide-right-out"),P.classList.remove("slide-right-in"),P.classList.add("slide-right-out"),setTimeout(()=>{I(),P.classList.add("slide-right-in")},1e3*this.#P),setTimeout(()=>{P.classList.remove("slide-right-out"),P.classList.remove("slide-right-in")},1e3*this.#P+1e3*this.#P)}return;case"fade":P.classList.remove("fade-in"),P.classList.add("fade-out"),setTimeout(()=>{I(),P.classList.add("fade-in"),P.classList.remove("fade-out")},1e3*this.#P),setTimeout(()=>{P.classList.remove("fade-in")},1e3*this.#P+1e3*this.#P);return}}#$(S=this.#g){let _="";if("fit"==this.#i){_=`
#${S.id} > ${this.#l}{
    min-width:${this.#j};
}
`;let T=Math.floor(this.#d.offsetWidth/(parseInt(this.#j.match(/\d*/)[0])+parseInt(this.#h.match(/\d*/)[0])));S.style.gridTemplateColumns=`repeat(${T},1fr)`}else{_=`
#${S.id}{
    ${this.#Q}
}
#${S.id} > ${this.#l}{
    min-width:${this.#j};
    width:100%;
    max-width:${this.#i};
}
`;let L=Math.floor(this.#d.offsetWidth/parseInt(this.#i.match(/\d*/)[0]));S.style.gridTemplateColumns=`repeat(${L},${this.#i})`}if(null==document.getElementById("DataViewStyle")){let W=document.createElement("style");W.id="DataViewStyle",W.textContent+=_,this.#d.append(W)}else document.getElementById("DataViewStyle").textContent+=_}#_(A=this.#p){let x="";if("fit"==this.#r){x=`
#${A.id} > ${this.#u}{
    min-width:${this.#s};
}
`;let D=Math.floor(this.#d.offsetWidth/(parseInt(this.#s.match(/\d*/)[0])+parseInt(this.#q.match(/\d*/)[0])));A.style.gridTemplateColumns=`repeat(${D},1fr)`}else{x=`
#${A.id}{
    ${this.#Q}
}
#${A.id} > ${this.#u}{
    min-width:${this.#s};
    width:100%;
    max-width:${this.#r};
}
`;let O=Math.floor(this.#d.offsetWidth/parseInt(this.#r.match(/\d*/)[0]));A.style.gridTemplateColumns=`repeat(${O},${this.#r})`}if(null==document.getElementById("DataViewStyle")){let M=document.createElement("style");M.id="DataViewStyle",M.textContent+=x,this.#d.append(M)}else document.getElementById("DataViewStyle").textContent+=x}#Y(){return Math.ceil(this.#b.length/this.#G)}};class Templator{#ae;#M;templator=null;constructor(t){this.#ae={formatNum:this.formatNum},this.#M=t.lazyloadImageColor}register(t){this.templator=new t(this.#ae)}oneTimeParse(t){let e=t;return null!=this.templator&&void 0!=this.templator.oneTimeParse&&(e=this.templator.oneTimeParse(e)),e=(e=t.replace(/{{(.*?)}}/g,(t,e)=>{let[i,s]=e.split(":"),[,...r]=void 0!=s?s.split("|"):"",a=t;switch(i){case"date":let n=new Date;switch(s){case"y":a=n.getFullYear();break;case"m":a=n.getMonth()+1;break;case"d":a=n.getDate();break;default:a=`${n.getDate()}-${n.getMonth()+1}-${n.getFullYear()}`}break;case"time":let h=new Date;switch(s){case"h":a=h.getHours();break;case"m":a=h.getMinutes();break;case"s":a=h.getSeconds();break;default:a=`${h.getHours()}:${h.getMinutes()}:${h.getSeconds()}`}}return a})).replace(/{{loadimage\|(.*?)>}}/g,(t,e)=>{let[i,s]=e.split("|"),r="";return s?.startsWith("<img")||(r=`width:${s};`,s=e.split("|")[2]),s?.match(/style=('|")(.*?)/)?s=`${s.slice(0,s.match(/style="?'?(.*?)/).index+7)}width:100%;height:100%;visibility:hidden;${s.slice(s.match(/style="?'?(.*?)/).index+7)}>`:s+=' style="width:100%;height:100%;visibility:hidden;">',`<div style="${r}height:${i};background:${this.#M};">${s=s.replace(/src=('|")(.*?)('|")/,(t,e,i)=>`data-view-loadimg="${i}"`)}</div>`})}parseOnEveryRow(t,e,i){let s=t;return null!=this.templator&&void 0!=this.templator.parseOnEveryRow&&(s=this.templator.parseOnEveryRow(s,e,i)),s=s.replace(/{%(.[^{%]*?)%}/g,(t,s)=>{let[r,a,n]=s.split(":"),[h,l]=void 0!=a?a.split("|"):"",o=t;switch(r){case"counter":o=i+1;break;case"column":let d=h.match(/\[([^)]+)\]/);if(o=d?e[h.slice(0,d?.index)][d[1]]:e[h],void 0==e[h])return;switch(l){case"upper":o=o.toUpperCase();break;case"lower":o=o.toLowerCase();break;case"firstCap":o=o[0].toUpperCase()+o.slice(1).toLowerCase();break;case"length":o=o.slice(0,Number(n)+1);break;case"formatNum":o=this.formatNum(o)}}return o})}formatNum(t){let e=t.toString().split("");return 5==e.length&&"."!=e[2]?e.splice(2,0,","):"."!=e[3]&&e.length>3&&e.splice(3,0,","),-1!=e.indexOf(".")&&e.length>e.indexOf(".")+2&&(e.length=e.indexOf(".")+2),e.join("")}}